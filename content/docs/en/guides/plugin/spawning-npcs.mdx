---
title: "Spawning NPCs"
description: "Learn how to easily spawn NPCs using the NPCPlugin helper."
---

While you can manually spawn entities using `Holder<EntityStore>` as described in the [Spawning Entities](./spawning-entities) guide, the `NPCPlugin` provides a more convenient way to spawn Non-Player Characters (NPCs) with built-in functionality.

## Using NPCPlugin

The `NPCPlugin` simplifies the process of creating an entity, attaching a model, and handling initial setup. It returns a `Pair` containing the entity reference and the NPC interface.

### Example Command

The following example demonstrates how to create a command that spawns a "Kweebec Sapling" NPC at the player's location and sets up its inventory.

```java
import com.example.npc.NPCPlugin; // Adjust imports as necessary
import hytale.server.plugin.npc.INonPlayerCharacter;
import hytale.server.plugin.npc.NPCEntity;
// ... other imports

public class SpawnNpcCommand extends AbstractPlayerCommand {
    public SpawnNpcCommand() {
        // Register the command /npc which will trigger the "spawn npc" action
        super("npc", "spawn npc");
    }

    @Override
    protected void execute(@NonNullDecl CommandContext commandContext,
            @NonNullDecl Store<EntityStore> store,
            @NonNullDecl Ref<EntityStore> ref,
            @NonNullDecl PlayerRef playerRef,
            @NonNullDecl World world) {

        // Get the player's current position to spawn the NPC at the same location
        Vector3d position = playerRef.getTransform().getPosition();
        // Define the initial rotation (facing direction) for the NPC
        Vector3f rotation = new Vector3f(0, 0, 0);

        // Use the NPCPlugin helper to spawn the NPC.
        // Parameters:
        // 1. store: The entity store where the NPC will exist
        // 2. "Kweebec_Sapling": The key/name of the entity model/type
        // 3. null: (Optional configuration, passed as null here)
        // 4. position: Where to spawn the NPC
        // 5. rotation: How the NPC is oriented
        Pair<Ref<EntityStore>, INonPlayerCharacter> result = NPCPlugin.get().spawnNPC(store, "Kweebec_Sapling", null,
                position, rotation);

        if (result != null) {
            // Successfully spawned
            Ref<EntityStore> npcRef = result.first();
            // Retrieve the NPC interface if needed for further interaction
            INonPlayerCharacter npc = result.second();

            // Set up the NPC's inventory and equipment
            setupNPCInventory(npcRef, store);
        }
    }

    /**
     * Configures the inventory for the spawned NPC.
     */
    public void setupNPCInventory(Ref<EntityStore> npcRef, Store<EntityStore> store) {
        // Retrieve the NPCEntity component to access inventory settings
        NPCEntity npcComponent = store.getComponent(npcRef, Objects.requireNonNull(NPCEntity.getComponentType()));
        
        if (npcComponent == null)
            return;

        // Initialize inventory size (e.g., 3 rows, 9 columns, 0 offset)
        npcComponent.setInventorySize(3, 9, 0);
        
        // Add items to the initialized inventory
        addItemsToNPCInventory(npcComponent.getInventory());
    }

    /**
     * Adds specific items and armor to the NPC's inventory.
     */
    public void addItemsToNPCInventory(Inventory inventory) {
        // Add a Thorium Mace to the first slot of the hotbar
        inventory.getHotbar().addItemStackToSlot((short) 0, new ItemStack("Weapon_Mace_Thorium", 1));
        
        // Equip a Thorium Helmet using the InventoryHelper
        InventoryHelper.useArmor(inventory.getArmor(), "Armor_Thorium_Head");
        
        // Set the active hotbar slot to the weapon
        inventory.setActiveHotbarSlot((byte) 0);
    }
}
```

## Code Breakdown

### 1. Spawning the NPC
The core of this method is the call to `NPCPlugin.get().spawnNPC(...)`.
```java
Pair<Ref<EntityStore>, INonPlayerCharacter> result = NPCPlugin.get().spawnNPC(store, "Kweebec_Sapling", null, position, rotation);
```
This single line replaces much of the boilerplate required when constructing a `Holder` manually. It handles creating the entity, assigning the model, and positioning it in the world.

### 2. Handling the Result
The method returns a `Pair`. You should always check if the result is not null, which indicates a successful spawn.
- `result.first()`: Gives you the `Ref<EntityStore>`, which is the reference to the entity in the ECS. You need this to add components or modify the entity later.
- `result.second()`: Gives you the `INonPlayerCharacter` interface, which provides NPC-specific methods.

### 3. Inventory Management
The example also shows how to customize the NPC:
- **Retrieving Components**: `store.getComponent(npcRef, ...)` is used to get the `NPCEntity` component.
- **Setting Inventory Size**: `npcComponent.setInventorySize(3, 9, 0)` defines the storage capacity.
- **Equipping Items**: You can access the `Inventory` object to add items (`addItemStackToSlot`) or equip armor (`InventoryHelper.useArmor`).

This approach is much faster for standard NPC requirements than manually composing every component.
