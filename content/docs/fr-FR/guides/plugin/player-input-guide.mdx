---
title: Guide des Entrées et Raccourcis Clavier du Joueur
description: Comment gérer les entrées du joueur.
authors:
  - name: Vibe Theory
    url: https://discord.com/users/145420279294722048
---

## Les Bases

Les serveurs Hytale **ne reçoivent PAS les entrées clavier brutes.** Au lieu de cela, les clients envoient des `paquets` de types d'interaction :

- **Événements de souris** - clics avec informations de cible
- **États de mouvement** - 22 drapeaux booléens (marche, saut, etc.)
- **Types d'interaction** - quelle action le joueur effectue

---

## Limitations des Raccourcis Clavier

En raison de l'utilisation de `paquets` et non d'entrées de touches, vous ne pouvez pas assigner votre sort Boule de Feu personnalisé à X.

_Il existe une solution de contournement abordée ci-dessous, mais comprenons d'abord la base :_

**Vous NE POUVEZ PAS :**

- Ajouter de nouveaux raccourcis clavier (le mappage du clavier est côté client)
- Remapper les touches existantes
- Ajouter plus de 3 emplacements de capacité

**Vous POUVEZ :**

- Intercepter les `paquets` et détourner leur objectif
- Utiliser 3 emplacements de capacité intégrés (`Ability1`, `Ability2`, `Ability3`)
- Rendre les capacités dépendantes des objets (baguette = boule de feu, épée = tranche)
- Détecter maintien vs appui, double-clic, bascule (via le timing)
- Contrôle complet de la souris (tous les 5 boutons, pression/relâchement, glisser)

### Emplacements d'Entrée Fixes

| Action         | Touche par Défaut | Le Serveur Reçoit           | Notes                   |
| -------------- | ----------------- | --------------------------- | ----------------------- |
| Souris Gauche  | LMB               | `InteractionType.Primary`   | Attaque/casser          |
| Souris Droite  | RMB               | `InteractionType.Secondary` | Utiliser/placer         |
| Capacité Arme  | Q                 | `InteractionType.Ability1`  | Actif - spécial d'arme  |
| Emplacement 2  | —                 | `InteractionType.Ability2`  | Placeholder inutilisé   |
| Emplacement 3  | —                 | `InteractionType.Ability3`  | Placeholder inutilisé   |
| Interagir      | E                 | `InteractionType.Use`       | Interagir avec le monde |
| Sélection Bloc | MMB               | `InteractionType.Pick`      | Copier type de bloc     |
| Esquive        | —                 | `InteractionType.Dodge`     | Mécanique d'esquive     |

**Note :** Seul `Ability1` (touche Q) est activement utilisé pour les capacités d'arme. `Ability2` et `Ability3` existent dans l'énumération mais n'ont pas de raccourcis par défaut et rien dans le code ne les référence : ils semblent être réservés pour une utilisation future.

Ce sont les seules actions clavier que le serveur voit.

---

## Intercepter les Paquets

C'est la solution de contournement pour les raccourcis clavier personnalisés du joueur. En interceptant les paquets d'entrée, vous pouvez rediriger le déclencheur d'événement vers votre propre classe. Il y a un **avertissement majeur avec cette stratégie :** Cela remplacera le mappage de touches par défaut à moins que vous ne le redirigiez autrement.

Voir [Référence des Entrées Client](https://hytalemodding.dev/en/docs/guides/plugin/client-inputs-reference) pour une liste complète de tous les paquets client-serveur.

Par exemple, intercepter Q pour utiliser un sort Boule de Feu personnalisé = Les capacités d'arme Hytale deviennent inutilisables.

C'est parce que vous n'interceptez pas Q, mais plutôt `InteractionType.Ability1`. Vous devriez rediriger un paquet différent vers ces capacités recréées dans votre propre mod (cela détournera bien sûr aussi un autre paquet). La référence des entrées client ci-dessus montre tous les paquets. _Conseil Pro : Les outils de construction lorsqu'ils ne sont pas en mode créatif sont un excellent point de départ._

### Exemple : Outils de Construction -> Capacités de Combat

C'est l'un des meilleurs systèmes à capturer, car il intercepte des paquets qui ne sont même pas utilisés pendant le jeu standard.

```java
// 1. Grant permission on join (in PlayerReadyEvent handler)
PermissionsModule.get().addUserPermission(
    playerRef.getUuid(),
    Set.of("hytale.editor.builderTools")
);

// 2. Intercept in packet handler
void handleBuilderToolAction(BuilderToolGeneralAction packet, PlayerRef playerRef) {
    Ref<EntityStore> ref = playerRef.getReference();
    if (ref == null) return;
    
    Store<EntityStore> store = ref.getStore();
    Player playerComponent = (Player) store.getComponent(ref, Player.getComponentType());
    
    if (playerComponent.getGameMode() != GameMode.Creative) {
        // Hijack for abilities
        switch (packet.action) {
            case ActivateToolMode -> castFireball(playerRef);   // B pressed
            case DeactivateToolMode -> endFireball(playerRef);  // B released
            case HistoryUndo -> castRewind(playerRef);          // Ctrl+Z
            case HistoryRedo -> castHaste(playerRef);           // Ctrl+Y
            case SelectionCopy -> castClone(playerRef);         // Ctrl+C
        }
        return;  // Don't run actual builder tool logic
    }
    // Creative players get normal behavior
    super.handleBuilderToolAction(packet, playerRef);
}
```

Vous pouvez faire cela avec n'importe quoi, donc un raccourci clavier personnalisé pour l'interface utilisateur, le gameplay, etc.

**Note Critique :** Si le joueur change les raccourcis clavier, vous ne le saurez pas, donc vos guides doivent référencer les contrôles Hytale par défaut. De plus, s'ils changent les raccourcis clavier en raison de votre mod (n'aimant pas Ctrl+C comme capacité par exemple), le paramètre les suit et peut impacter leur expérience en dehors de votre écosystème. Important à considérer lors du choix des paquets.

###

---

## Entrées de Souris

Quelques informations utiles sur les entrées de souris

### Écouter les Clics de Souris

```java
@Override
protected void setup() {
    getEventRegistry().register(PlayerMouseButtonEvent.class, event -> {
        MouseButtonEvent mouse = event.getMouseButton();

        if (mouse.mouseButtonType == MouseButtonType.Left
                && mouse.state == MouseButtonState.Pressed) {
            // Left click!
            Entity target = event.getTargetEntity();
            Vector3i block = event.getTargetBlock();
        }

        // Cancel the click
        // event.setCancelled(true);
    });
}
```

---

### Types de Boutons de Souris

```java
MouseButtonType.Left    // Primary click
MouseButtonType.Right   // Secondary click
MouseButtonType.Middle  // Scroll wheel click
MouseButtonType.X1      // Side button 1
MouseButtonType.X2      // Side button 2
```

```java
MouseButtonState.Pressed   // Button down
MouseButtonState.Released  // Button up
```

---

### Ce Que Vous Obtenez des Événements de Souris

| Propriété           | Type             | Description                           |
| ------------------- | ---------------- | ------------------------------------- |
| `getMouseButton()`  | MouseButtonEvent | Type de bouton, état, nombre de clics |
| `getTargetEntity()` | Entity           | Entité sous le curseur (ou null)      |
| `getTargetBlock()`  | Vector3i         | Position du bloc sous le curseur      |
| `getItemInHand()`   | Item             | Objet actuellement tenu               |
| `getScreenPoint()`  | Vector2f         | Position du curseur à l'écran         |
| `getPlayer()`       | Player           | Le joueur qui a cliqué                |

**Détection de double-clic :**

```java
if (mouse.clicks >= 2) {
    // Double-clicked!
}
```

### Imports

```java
import com.hypixel.hytale.protocol.MouseButtonType;
import com.hypixel.hytale.protocol.MouseButtonState;
import com.hypixel.hytale.protocol.MouseButtonEvent;
import com.hypixel.hytale.protocol.InteractionType;
import com.hypixel.hytale.server.core.event.events.player.PlayerMouseButtonEvent;
import com.hypixel.hytale.server.core.event.events.player.PlayerMouseMotionEvent;
```

---

### Événements de Joueur Disponibles

Tous les événements de joueur qui peuvent être enregistrés via `getEventRegistry()` :

| Événement                    | Description                          |
| ---------------------------- | ------------------------------------ |
| `PlayerConnectEvent`         | Joueur se connectant au serveur      |
| `PlayerDisconnectEvent`      | Joueur se déconnectant               |
| `PlayerSetupConnectEvent`    | Phase de configuration de connexion  |
| `PlayerSetupDisconnectEvent` | Phase de configuration déconnexion   |
| `PlayerReadyEvent`           | Joueur complètement chargé et prêt   |
| `PlayerChatEvent`            | Message de chat envoyé               |
| `PlayerInteractEvent`        | Interaction avec monde/entités       |
| `PlayerMouseButtonEvent`     | Pression/relâchement bouton souris   |
| `PlayerMouseMotionEvent`     | Mouvement de la souris               |
| `PlayerCraftEvent`           | Objet fabriqué                       |
| `AddPlayerToWorldEvent`      | Joueur ajouté à un monde             |
| `DrainPlayerFromWorldEvent`  | Joueur retiré du monde               |

---

## Conseils

- **1 emplacement de capacité actif** : Seul `Ability1` (Q) est actuellement utilisé - rendez-le dépendant de l'objet
- **Annuler les événements** : Utilisez `event.setCancelled(true)` pour bloquer l'action
- **États de mouvement** : Vérifiez-les dans les systèmes pour une surveillance continue
- **Double-clic** : Vérifiez `mouse.clicks >= 2`
- **Maintien vs appui** : Suivez vous-même le timing pression/relâchement
- **Informations de cible** : Les événements incluent quel bloc/entité le joueur ciblait
- **Pas d'événement de mouvement** : Interrogez `TransformComponent` ou vérifiez `MovementStates` à la place

---

_Depuis Hytale Server build `2026.01.13-dcad8778f`_
